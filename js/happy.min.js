(function happyJS(c){function b(d){return("".trim)?d.val().trim():c.trim(d.val())}c.fn.isHappy=function a(f){var i=[],n;var m=false;function e(o){return !!(o&&o.constructor&&o.call&&o.apply)}function j(o){var p=f.classes&&f.classes.message||"unhappyMessage";return c('<span id="'+o.id+'" class="'+p+'" role="alert">'+o.message+"</span>")}function g(o){if(e(f.errorTemplate)){return f.errorTemplate(o)}return j(o)}function h(){var p,o;var q=false;for(p=0,o=i.length;p<o;p+=1){if(!i[p].testValid(true)){q=true}}if(q){if(e(f.unHappy)){f.unHappy()}return false}else{if(f.testMode){if(e(f.happy)){f.happy()}if(window.console){console.warn("would have submitted")}return false}}if(e(f.happy)){f.happy()}}function l(){m=false}function d(){m=true;c(window).bind("mouseup",l)}function k(r,o){var t=c(o);var p={message:r.message||"",id:o.slice(1)+"_unhappy"};var u=c(p.id).length>0?c(p.id):g(p);var q=function q(){if(!m){t.testValid()}else{c(window).bind("mouseup",t.testValid.bind(this))}};i.push(t);t.testValid=function s(z){var w,x,D;var v=c(this);var A=false;var y=!!v.get(0).attributes.getNamedItem("required")||r.required;var C=(t.attr("type")==="password");var E=e(r.arg)?r.arg():r.arg;var B=f.classes&&f.classes.field||"unhappy";if(e(r.clean)){w=r.clean(v.val())}else{if(!C&&typeof r.trim==="undefined"||r.trim){w=b(v)}else{w=v.val()}}v.val(w);x=((w.length>0||y==="sometimes")&&e(r.test));if(z===true&&y===true&&w.length===0){A=true}else{if(x){A=!r.test(w,E)}}if(A){v.addClass(B).after(u);return false}else{D=u.get(0);if(D.parentNode){D.parentNode.removeChild(D)}v.removeClass(B);return true}};t.bind(r.when||f.when||"blur",q)}for(n in f.fields){k(f.fields[n],n)}c(f.submitButton||this).bind("mousedown",d);if(f.submitButton){c(f.submitButton).click(h)}else{this.bind("submit",h)}return this}})(this.jQuery||this.Zepto);